{% extends "home.html" %} {% block scripts %} {{ super() }}
<script>
    var post_id = /articles\/(\d+)/.exec(window.location.href)[1];
    var editorLoaded = false;
    var articleUrl = "/api/v1/articles/" + post_id
    var renderer = new marked.Renderer()
    marked.setOptions({
        renderer: renderer,
        gfm: true,
        tables: true,
        breaks: false,
        pedantic: false,
        sanitize: false,
        smartLists: true,
        smartypants: false,
        highlight: function (code) {
            return hljs.highlightAuto(code).value;
        }
    });
    renderer.code = function (code, language) {
        var lang = language;
        if (!language) {
            lang = 'python';
        }
        var highlighted = hljs.highlight(lang, code).value;
        return '<pre class="hljs"><code class="hljs ' + lang + '">' + highlighted + '</code></pre>';
    };
    $("Document").ready(function () {
        if (editorLoaded) {
            return;
        }
        $.ajax({
            url: articleUrl,
            type: "get",
            dataType: "json",
            success: function (data, status) {
                if (data.code == 200) {
                    $("#articleTitle").val(data.title);
                    $("#editor").val(data.content);
                }
            }
        });
        editorLoaded = true;
    });
    $("#editor").markdown({
        autofocus: true,
        savable: false,
        onSave: function (e) {
            var content = e.getContent();
            var html = e.parseContent();
            var title = $("#articleTitle").val();
            $.ajax({
                url: articleUrl,
                type: "put",
                data: {
                    title: title,
                    html: html,
                    content: content
                },
                dataType: "json",
                success: function (data, status) {
                    $("#saveInfo").text(data.message);
                }
            });
        }
    });
</script>
{% endblock %} {% block azone %}
<form id="mdForm">
    <div class="form-group">
        <input class="form-control" type="text" name="articleTitle" id="articleTitle" placeholder="标题">
    </div>
    <textarea id="editor" data-provide="markdown" data-savable="true" rows="50"></textarea>
</form>
<small class="text-info" id="saveInfo"></small>
{% endblock %}